const C={fid:'registrationForm',rid:'resultContainer',fcid:'form-container',sb:'.submit-btn',ld:'loading',e:'error',se:'show-error',h:'hidden',php:'process_registration.php',so:50,sd:500,ma:18,mnl:2,mal:5,mcl:2,msl:2,mcnl:2},f={fn:$('#firstName'),ln:$('#lastName'),em:$('#email'),ph:$('#phone'),ad:$('#address'),ct:$('#city'),st:$('#state'),cn:$('#country'),gn:$('#gender'),db:$('#dob'),ms:$('#message'),tm:$('#terms')},p={n:/^[a-zA-Z\s'-]{2,}$/,e:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,ph:/^[\d\s()+-]{10,}$/},m={fn:{r:'First name is required',l:'Min 2 chars',i:'Invalid first name'},ln:{r:'Last name is required',l:'Min 2 chars',i:'Invalid last name'},em:{r:'Email required',i:'Invalid email'},ph:{r:'Phone required',i:'Invalid phone'},ad:{r:'Address required',l:'Min 5 chars'},ct:{r:'City required',l:'Min 2 chars',i:'Invalid city'},st:{r:'State required',l:'Min 2 chars'},cn:{r:'Country required',l:'Min 2 chars'},gn:{r:'Select gender'},db:{r:'DOB required',i:'Must be 18+'},tm:{r:'Agree to terms'}};$(document).ready(()=>{initializeEventListeners();setupFormValidation();console.log('Form initialized')});

function initializeEventListeners(){$('#'+C.fid).on('submit',e=>{e.preventDefault();handleFormSubmission()});$(document).on('input change','.form-group input, .form-group select, .form-group textarea',function(){clearFieldError($(this))});$('.form-group input, .form-group select, .form-group textarea').on('focus',function(){$(this).closest('.form-group').addClass('focused')}).on('blur',function(){$(this).closest('.form-group').removeClass('focused')})}function setupFormValidation(){f.ph.on('input',function(){let v=$(this).val().replace(/\D/g,'');if(v.length>10)v=v.substring(0,10);$(this).val(v)});f.fn.on('change',function(){$(this).val(properCase($(this).val()))});f.ln.on('change',function(){$(this).val(properCase($(this).val()))});f.ct.on('change',function(){$(this).val(properCase($(this).val()))});f.st.on('change',function(){$(this).val(properCase($(this).val()))});f.cn.on('change',function(){$(this).val(properCase($(this).val()))})}function handleFormSubmission(){clearAllErrors();if(validateForm()){const d=collectFormData();submitFormToServer(d)}else{scrollToFirstError()}}function collectFormData(){return{firstName:f.fn.val().trim(),lastName:f.ln.val().trim(),email:f.em.val().trim(),phone:f.ph.val().trim(),address:f.ad.val().trim(),city:f.ct.val().trim(),state:f.st.val().trim(),country:f.cn.val().trim(),gender:f.gn.val(),dob:f.db.val(),message:f.ms.val().trim(),terms:f.tm.is(':checked')}}function submitFormToServer(d){const $btn=$('#'+C.fid).find(C.sb),orig=$btn.text();$btn.prop('disabled',true).addClass(C.ld).html(orig+' <span class="spinner">...</span>');$.ajax({url:C.php,type:'POST',data:d,dataType:'json',timeout:10000,success:r=>{$btn.prop('disabled',false).removeClass(C.ld).text(orig);if(r.success){showSuccessMessage('Registered!');setTimeout(()=>{displayResults(d);scrollToResults()},300)}else{showErrorAlert('Error',r.message||'Unknown')}},error:(x,s,e)=>{$btn.prop('disabled',false).removeClass(C.ld).text(orig);console.error('Error:',e);if(s==='timeout'){showErrorAlert('Timeout','Request too long')}else{showErrorAlert('Error','Failed to submit')}}})}function resetSubmitButton($b,o){$b.prop('disabled',false).removeClass(C.ld).text(o)}function validateForm(){let x=true;if(!validateFirstName())x=false;if(!validateLastName())x=false;if(!validateEmail())x=false;if(!validatePhone())x=false;if(!validateAddress())x=false;if(!validateCity())x=false;if(!validateState())x=false;if(!validateCountry())x=false;if(!validateGender())x=false;if(!validateDateOfBirth())x=false;if(!validateTerms())x=false;return x}

function validateFirstName(){const v=f.fn.val().trim();
    if(!v){showFieldError(f.fn,m.fn.r);return false}
    if(v.length<C.mnl){showFieldError(f.fn,m.fn.l);return false}
    if(!p.n.test(v)){showFieldError(f.fn,m.fn.i);return false}return true}function validateLastName(){const v=f.ln.val().trim();
        if(!v){showFieldError(f.ln,m.ln.r);return false}
    if(v.length<C.mnl){showFieldError(f.ln,m.ln.l);return false}
    if(!p.n.test(v)){showFieldError(f.ln,m.ln.i);return false}return true}function validateEmail(){const v=f.em.val().trim();
        if(!v){showFieldError(f.em,m.em.r);return false}if(!p.e.test(v)){showFieldError(f.em,m.em.i);return false}return true}function validatePhone(){const v=f.ph.val().trim();
            if(!v){showFieldError(f.ph,m.ph.r);return false}
    if(!p.ph.test(v.replace(/\s/g,''))){showFieldError(f.ph,m.ph.i);return false}return true}function validateAddress(){const v=f.ad.val().trim();
        if(!v){showFieldError(f.ad,m.ad.r);return false}if(v.length<C.mal){showFieldError(f.ad,m.ad.l);return false}return true}function validateCity(){const v=f.ct.val().trim();
        if(!v){showFieldError(f.ct,m.ct.r);return false}
        if(v.length<C.mcl){showFieldError(f.ct,m.ct.l);return false}
        if(!p.n.test(v)){showFieldError(f.ct,m.ct.i);return false}return true}function validateState(){const v=f.st.val().trim();
            if(!v){showFieldError(f.st,m.st.r);return false}
        if(v.length<C.msl){showFieldError(f.st,m.st.l);return false}return true}function validateCountry(){const v=f.cn.val().trim();
            if(!v){showFieldError(f.cn,m.cn.r);return false}
            if(v.length<C.mcnl){showFieldError(f.cn,m.cn.l);return false}return true}function validateGender(){if(!f.gn.val()){showFieldError(f.gn,m.gn.r);return false}return true}function validateDateOfBirth(){const v=f.db.val();
                if(!v){showFieldError(f.db,m.db.r);return false}if(!isValidAge(v)){showFieldError(f.db,m.db.i);return false}return true}function validateTerms(){if(!f.tm.is(':checked')){showFieldError(f.tm,m.tm.r);return false}return true}function isValidAge(d){const bd=new Date(d),td=new Date(),a=td.getFullYear()-bd.getFullYear(),mo=td.getMonth()-bd.getMonth();return(mo<0||(mo===0&&td.getDate()<bd.getDate())?a-1:a)>=C.ma}

function showFieldError($f,msg){$f.addClass(C.e);const $g=$f.closest('.form-group');$g.addClass(C.se).find('.error-message').text(msg)}function clearFieldError($f){if($f.hasClass(C.e)){$f.removeClass(C.e);const $g=$f.closest('.form-group');$g.removeClass(C.se);$g.find('.error-message').text('')}}function clearAllErrors(){$('.form-group').removeClass(C.se);$('.form-group input, .form-group select, .form-group textarea').removeClass(C.e);$('.error-message').text('')}function showErrorAlert(t,msg){alert(t+'\n\n'+msg)}function showSuccessMessage(msg){console.log('Success:',msg)}function scrollToFirstError(){const $fe=$('.form-group.'+C.se).first();if($fe.length){$('html, body').animate({scrollTop:$fe.offset().top-C.so},C.sd)}}function displayResults(d){$('#displayName').text(d.firstName+' '+d.lastName);$('#displayEmail').text(d.email);$('#displayPhone').text(formatPhoneNumber(d.phone));$('#displayAddress').text(d.address);$('#displayCity').text(d.city);$('#displayState').text(d.state);$('#displayCountry').text(d.country);$('#displayGender').text(d.gender);$('#displayDob').text(formatDateForDisplay(d.dob));if(d.message&&d.message.trim()){$('#messageItem').show();$('#displayMessage').text(d.message)}else{$('#messageItem').hide()}$('#'+C.rid).removeClass(C.h);$('.'+C.fcid).hide()}function scrollToResults(){$('html, body').animate({scrollTop:$('#'+C.rid).offset().top-C.so},C.sd)}function resetForm(){$('#'+C.fid)[0].reset();$('#'+C.rid).addClass(C.h);$('.'+C.fcid).show();clearAllErrors();$('html, body').animate({scrollTop:$('.'+C.fcid).offset().top-C.so},C.sd);console.log('Form reset')}function properCase(s){if(!s)return'';return s.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())}function formatPhoneNumber(ph){const d=ph.replace(/\D/g,'');if(d.length===10){return'('+d.substring(0,3)+') '+d.substring(3,6)+'-'+d.substring(6)}return ph}function formatDateForDisplay(ds){const d=new Date(ds);const o={year:'numeric',month:'long',day:'numeric'};return d.toLocaleDateString('en-US',o)}function getFormDataAsJSON(){return JSON.stringify(collectFormData(),null,2)}function logFormData(){console.table(collectFormData())}function validateFieldByName(fn){const v={'firstName':validateFirstName,'lastName':validateLastName,'email':validateEmail,'phone':validatePhone,'address':validateAddress,'city':validateCity,'state':validateState,'country':validateCountry,'gender':validateGender,'dob':validateDateOfBirth,'terms':validateTerms};if(v[fn]){return v[fn]()}return false}function getAllFormErrors(){const e={};if(!validateFirstName())e.firstName=m.fn;if(!validateLastName())e.lastName=m.ln;if(!validateEmail())e.email=m.em;if(!validatePhone())e.phone=m.ph;if(!validateAddress())e.address=m.ad;if(!validateCity())e.city=m.ct;if(!validateState())e.state=m.st;if(!validateCountry())e.country=m.cn;if(!validateGender())e.gender=m.gn;if(!validateDateOfBirth())e.dob=m.db;if(!validateTerms())e.terms=m.tm;return e}function exportFormDataAsCSV(d){const csv=[['Field','Value'],['First Name',d.firstName],['Last Name',d.lastName],['Email',d.email],['Phone',d.phone],['Address',d.address],['City',d.city],['State',d.state],['Country',d.country],['Gender',d.gender],['Date of Birth',d.dob],['Additional Info',d.message]];return csv.map(r=>r.map(c=>'"'+c+'"').join(',')).join('\n')}console.log('Form script loaded');
